<!DOCTYPE html>
<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="feeding-mark-analysis">feeding mark analysis</h1>
<p>This repository contains scripts for data collection and image processing for quantitative analysis of insect feeding marks on plant leaves, related to publication [<strong>add-link-when-published</strong>].</p>
<h2 id="requirement">Requirement</h2>
<ul>
<li>
<p>A photo scanner and its driver software.</p>
</li>
<li>
<p><a href="https://www.vector.co.jp/soft/winnt/util/se115105.html">UWSC</a> or alternative keyborad/mouse macro tools. This will be used to operate printer driver software to repeat scan over time by sending key command with a set interval.</p>
</li>
<li>
<p><a href="https://imagej.net/ij/">ImageJ</a> or <a href="https://fiji.sc/">FiJi</a> for image processing.</p>
</li>
<li>
<p><a href="">R</a> for data processing and visualization.</p>
</li>
</ul>
<h2 id="workflow">Workflow</h2>
<h3 id="step-1-image-scanning">Step 1. Image scanning</h3>
<p>For time-lapse scanning, a scanner is operated through its driver software. Instead of manual operation, a key command to start scanning is sent with desired interval by keyboard/mouse macro tool.<br>
Here is an example of scanning automation with EPSON GTX-980 scanner with UWSC mouse/keyboard macro.</p>
<ol>
<li>Open scanner driver software.</li>
<li>Set up scanning and saving options. Serial numbers in output filename suffix is essential for the donwstream analysis (ex. <code>feeding_track_001.jpg</code>, <code>feeding_track_002.jpg</code>, ...).</li>
<li>If needed, open the script <code>scripts/time_lapse_scan.uws</code> with text editor and edit the followings:
<code>interval = 60</code>  to change the scanning interval (unit: second)<br>
<code>KBD(VK_S)</code> to change the key command to send to the scanner driver. <code>VK_S</code> means &quot;S&quot; key, which is a shortcut key of the Epson scanner driver software to start scanning.</li>
<li>Launch UWSC and load the script <code>scripts/time_lapse_scan.uws</code>.</li>
<li>Start running the  macro from UWSC. Click the main window of the scanner driver software to make it active. Note that the key command from UWSC will be send to the active window.</li>
</ol>
<h3 id="step-2-image-processing">Step 2. Image processing</h3>
<p>Run ImageJ/Fiji macro, that load the scanned images (.jpg) and process them to quantify leaf area of each ROI and frames.</p>
<ol>
<li>The ImageJ macro assumes the following file structure. Here is an example of a project (ex. &quot;project1&quot;. The project folder name is arbitrary). Put your scanned images with sequential suffix numbers in <code>project1/raw/</code>.</li>
</ol>
<pre>
project1
├─output 
├─raw
│  ├─feeding_track_001.jpg
│  ├─feeding_track_002.jpg
│  ├─...
├─roi
│  └─RoiSet.zip
└─scripts
</pre>
<ol start="2">
<li>
<p>Open one of the scanned image and define ROIs for leaf area quantification  using ROI manager. Save the ROI file (<code>RoiSet.zip</code>) in <code>project1/roi/</code>.</p>
</li>
<li>
<p>Open either of macro file in <code>scripts/</code> with Fiji/ImageJ.</p>
</li>
</ol>
<ul>
<li><code>feeding-mark-analyzer-light-bg.ijm</code> for white background images (i.e. scanner in transmissive mode)</li>
<li><code>feeding-mark-analyzer-dark-bg.ijm</code>  for black background images (i.e. scanner in reflective mode)</li>
</ul>
<p>Close any images/results in ImageJ to prevent possible trouble when running the macro. Click &quot;Run&quot; on the macro editor. You will see three dialog boxes for selecting an input file directory(<code>project1/raw</code>), a ROI file(<code>project1/roi/RoiSet.zip</code>), and an output directory(<code>project1/output</code>).  Wait until &quot;Completed !&quot; message appears in the log window. It creates three output directories:</p>
<ol>
<li><code>mask1</code><br>
Binary JPEG images after color thresholding.</li>
<li><code>mask2</code><br>
Binary JPEG images for leaf detection after cumulative time-difference masking.</li>
<li><code>measurement</code><br>
Excel files for leaf area of each ROI. A file will be created for each image.</li>
</ol>
<pre>
project1
├─output 
│  ├─mask1
│  │  ├─feeding_track_001.jpg
│  │  ├─feeding_track_002.jpg
│  │  ├─...
│  ├─mask2  
│  │  ├─feeding_track_001.jpg
│  │  ├─feeding_track_002.jpg
│  │  ├─...
│  ├─measurement
│  │  ├─feeding_track_001.xls
│  │  ├─feeding_track_002.xls
│  │  ├─...
├─raw
│  ├─feeding_track_001.jpg
│  ├─feeding_track_002.jpg
│  ├─...
├─roi
│  └─RoiSet.zip
└─scripts
</pre>
<h3 id="step-3-data-processingvisualization">Step 3. Data processing/visualization</h3>
<p>Calculate/visualize feeding behavior parameters from the image analysis results using R package <code>feedingMarkAnalyzeR</code>.</p>
<p>See <a href="">vignette  -URL will be added when the article is published.-</a> in the package.</p>

</body>
</html>
